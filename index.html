<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥æœ¬å¤©æ°—äºˆå ±ãƒ»é›¨é›²ãƒ¬ãƒ¼ãƒ€ãƒ¼</title>
    <style>
        /* å…¨ä½“çš„ãªãƒªã‚»ãƒƒãƒˆã¨åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5; /* è–„ã„ã‚°ãƒ¬ãƒ¼ã®èƒŒæ™¯ */
            min-height: 100vh;
            color: #333; /* åŸºæœ¬ãƒ†ã‚­ã‚¹ãƒˆè‰² */
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: normal; /* å¤ªå­—ã«ã—ãªã„ */
        }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ï¼‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .controls {
            background: white;
            border: 1px solid #ddd;
            padding: 20px;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            gap: 15px; /* è¦ç´ é–“ã®ã‚¹ãƒšãƒ¼ã‚¹ */
            align-items: center; /* å‚ç›´æ–¹å‘ä¸­å¤®æƒãˆ */
            flex-wrap: wrap; /* å°ã•ã„ç”»é¢ã§æŠ˜ã‚Šè¿”ã™ */
            margin-bottom: 15px;
        }

        /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        select, input, button {
            padding: 8px 12px;
            border: 1px solid #ccc;
            font-size: 14px;
            background: white;
            border-radius: 4px; /* è§’ã‚’ä¸¸ãã™ã‚‹ */
        }

        select:focus, input:focus {
            outline: none;
            border-color: #666; /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®æ ç·šè‰² */
        }

        button {
            background: #333;
            color: white;
            border: 1px solid #333;
            cursor: pointer;
            transition: background 0.3s ease; /* ãƒ›ãƒãƒ¼æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        }

        button:hover {
            background: #555;
        }

        /* å¤©æ°—æƒ…å ±ã¨ãƒ¬ãƒ¼ãƒ€ãƒ¼ã®ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .weather-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* 2åˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
            gap: 20px;
            margin-bottom: 20px;
        }

        /* å„æƒ…å ±ã‚«ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .weather-card {
            background: white;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px; /* è§’ã‚’ä¸¸ãã™ã‚‹ */
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); /* è»½ã„å½± */
        }

        .weather-card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
            font-weight: normal;
            border-bottom: 1px solid #eee; /* ä¸‹ç·š */
            padding-bottom: 10px;
        }

        /* ç¾åœ¨ã®å¤©æ°—ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .current-weather {
            text-align: center;
        }

        .temperature {
            font-size: 3em;
            font-weight: normal;
            color: #333;
            margin: 15px 0;
        }

        .weather-icon {
            font-size: 3em;
            margin: 15px 0;
        }

        .weather-details {
            display: grid;
            grid-template-columns: 1fr 1fr; /* 2åˆ— */
            gap: 10px;
            margin-top: 20px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between; /* å·¦å³ã«é…ç½® */
            padding: 8px;
            background: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 4px;
        }

        /* ãƒ¬ãƒ¼ãƒ€ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ */
        .radar-container {
            position: relative;
            width: 100%;
            height: 400px;
            overflow: hidden;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .radar-map-wrapper {
            width: 100%;
            height: 100%;
            background: #e8f4f8; /* åœ°å›³ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹å‰ã®è‰² */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            color: #333;
            position: relative;
        }
        
        .radar-map-wrapper .radar-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* ãƒ€ãƒŸãƒ¼ã®é›¨é›²ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆå®Ÿéš›ã¯APIã‹ã‚‰å–å¾—ï¼‰ */
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="30" r="8" fill="rgba(0,100,255,0.5)"/><circle cx="60" cy="20" r="12" fill="rgba(0,150,255,0.6)"/><circle cx="80" cy="70" r="6" fill="rgba(0,200,255,0.4)"/><circle cx="40" cy="80" r="10" fill="rgba(0,120,255,0.5)"/></svg>') no-repeat center;
            background-size: cover;
            pointer-events: none; /* ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€é */
        }
        /* ãƒ¬ãƒ¼ãƒ€ãƒ¼éè¡¨ç¤ºæ™‚ã®overlayã‚¹ã‚¿ã‚¤ãƒ« */
        .radar-overlay.hidden {
            display: none;
        }


        /* äºˆå ±ãƒªã‚¹ãƒˆï¼ˆ3æ™‚é–“ã”ã¨äºˆå ±ã¨é€±é–“äºˆå ±å…±é€šï¼‰ */
        .forecast-list {
            display: grid;
            gap: 1px; /* å„äºˆå ±é …ç›®ã®é–“ã®ç·š */
            background: #ddd; /* ç·šã«è¦‹ã›ã‚‹ãŸã‚ã®èƒŒæ™¯è‰² */
            border-radius: 4px;
            overflow: hidden; /* è§’ã‚’ä¸¸ãã™ã‚‹ãŸã‚ã«å¿…è¦ */
        }

        .forecast-item {
            display: flex;
            justify-content: space-between; /* è¦ç´ ã‚’å·¦å³ã«é…ç½® */
            align-items: center; /* å‚ç›´æ–¹å‘ä¸­å¤®æƒãˆ */
            padding: 12px;
            background: white;
        }

        .forecast-date {
            font-weight: bold;
            color: #333;
        }

        .forecast-temp {
            font-size: 1.1em;
            font-weight: normal;
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ»ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 1.1em;
            color: #666;
        }

        .error {
            background: #ffebee; /* èµ¤ç³»ã®èƒŒæ™¯ */
            border: 1px solid #f44336; /* èµ¤ç³»ã®æ ç·š */
            color: #d32f2f; /* èµ¤ç³»ã®æ–‡å­—è‰² */
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ */
        @media (max-width: 768px) {
            .weather-grid {
                grid-template-columns: 1fr; /* 1åˆ—ã«å¤‰æ›´ */
            }
            
            .control-group {
                flex-direction: column; /* ç¸¦ä¸¦ã³ */
                align-items: stretch; /* å¹…ã„ã£ã±ã„ã«åºƒã’ã‚‹ */
            }
            
            h1 {
                font-size: 2em;
            }
        }

        /* æ¥ç¶šçŠ¶æ…‹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            margin-left: 8px;
            border-radius: 0%; /* ä¸¸ã„ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
        }

        .status-connected {
            background: #4caf50; /* ç·‘è‰² */
        }

        .status-error {
            background: #f44336; /* èµ¤è‰² */
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æ—¥æœ¬å¤©æ°—äºˆå ±ãƒ»é›¨é›²ãƒ¬ãƒ¼ãƒ€ãƒ¼</h1>
            <p style="color: #666; font-size: 1.1em;">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¤©æ°—æƒ…å ±ã¨ãƒ¬ãƒ¼ãƒ€ãƒ¼ç”»åƒ</p>
        </header>

        <div class="controls">
            <div class="control-group">
                <label for="prefecture">éƒ½é“åºœçœŒ:</label>
                <select id="prefecture">
                    <option value="tokyo">æ±äº¬éƒ½</option>
                    <option value="osaka">å¤§é˜ªåºœ</option>
                    <option value="kyoto">äº¬éƒ½åºœ</option>
                    <option value="fukuoka">ç¦å²¡çœŒ</option>
                    <option value="hokkaido">åŒ—æµ·é“</option>
                    <option value="okinawa">æ²–ç¸„çœŒ</option>
                    <option value="aichi">æ„›çŸ¥çœŒ</option>
                    <option value="kanagawa">ç¥å¥ˆå·çœŒ</option>
                    <option value="saitama">åŸ¼ç‰çœŒ</option>
                    <option value="chiba">åƒè‘‰çœŒ</option>
                </select>

                <label for="city">å¸‚åŒºç”ºæ‘:</label>
                <input type="text" id="city" placeholder="ä¾‹: æ¸‹è°·åŒº" value="æ¸‹è°·åŒº">

                <button onclick="updateWeather()">å¤©æ°—ã‚’å–å¾—</button>
                <button onclick="toggleRadar()">ãƒ¬ãƒ¼ãƒ€ãƒ¼è¡¨ç¤ºåˆ‡æ›¿</button>
            </div>
            
            <div class="control-group">
                <label for="update-interval">æ›´æ–°é–“éš”:</label>
                <select id="update-interval">
                    <option value="300000">5åˆ†</option>
                    <option value="600000">10åˆ†</option>
                    <option value="1800000">30åˆ†</option>
                    <option value="3600000">1æ™‚é–“</option>
                </select>
                
                <label>
                    <input type="checkbox" id="auto-update" checked> è‡ªå‹•æ›´æ–°
                </label>
                
                <span id="connection-status">æ¥ç¶šçŠ¶æ…‹: <span class="status-indicator status-connected"></span></span>
            </div>
        </div>

        <div class="weather-grid">
            <div class="weather-card">
                <h2>ç¾åœ¨ã®å¤©æ°—</h2>
                <div id="current-weather" class="current-weather">
                    <div class="loading">å¤©æ°—æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
                </div>
            </div>

            <div class="weather-card">
                <h2>é›¨é›²ãƒ¬ãƒ¼ãƒ€ãƒ¼</h2>
                <div id="radar-container" class="radar-container">
                    <div id="radar-map-wrapper" class="radar-map-wrapper">
                        <div class="radar-overlay"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="weather-card">
            <h2 id="hourly-forecast-title">3æ™‚é–“äºˆå ±</h2>
            <div id="hourly-forecast" class="forecast-list">
                <div class="loading">è©³ç´°äºˆå ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
            </div>
        </div>
        
        <div class="weather-card" style="margin-top: 20px;">
            <h2>é€±é–“å¤©æ°—äºˆå ±</h2>
            <div id="forecast" class="forecast-list">
                <div class="loading">äºˆå ±æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
            </div>
        </div>
    </div>

    <script>
        // å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†
        let weatherData = {};
        let updateInterval;
        let radarVisible = true;
        let currentCoordinates = null; // ç¾åœ¨ã®é¸æŠåœ°ç‚¹ã®ç·¯åº¦çµŒåº¦

        // OpenWeatherMap APIè¨­å®š
        const OPENWEATHER_API_KEY = '9ca05023ab69f12f379e8d7c36455b9d'; // â˜…ã“ã“ã«ã‚ãªãŸã®APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„â˜…
        const OPENWEATHER_BASE_URL = 'https://api.openweathermap.org/data/2.5';

        // éƒ½é“åºœçœŒã¨éƒ½å¸‚ã®ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆåˆæœŸé¸æŠè‚¢ã¨åº§æ¨™å–å¾—ç”¨ï¼‰
        const prefectures = {
            'tokyo': 'æ±äº¬éƒ½',
            'osaka': 'å¤§é˜ªåºœ',
            'kyoto': 'äº¬éƒ½åºœ',
            'fukuoka': 'ç¦å²¡çœŒ',
            'hokkaido': 'åŒ—æµ·é“',
            'okinawa': 'æ²–ç¸„çœŒ',
            'aichi': 'æ„›çŸ¥çœŒ',
            'kanagawa': 'ç¥å¥ˆå·çœŒ',
            'saitama': 'åŸ¼ç‰çœŒ',
            'chiba': 'åƒè‘‰çœŒ'
        };

        // å¤©æ°—ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆOpenWeatherMapã®ã‚¢ã‚¤ã‚³ãƒ³ã‚³ãƒ¼ãƒ‰ã¨çµµæ–‡å­—ï¼‰
        const weatherIcons = {
            '01d': 'â˜€ï¸', '01n': 'ğŸŒ™', // æ™´ã‚Œ
            '02d': 'â›…', '02n': 'â˜ï¸', // æ™´ã‚Œæ™‚ã€…æ›‡ã‚Š
            '03d': 'â˜ï¸', '03n': 'â˜ï¸', // æ›‡ã‚Š
            '04d': 'â˜ï¸', '04n': 'â˜ï¸', // ã©ã‚“ã‚ˆã‚Šæ›‡ã‚Š
            '09d': 'ğŸŒ§ï¸', '09n': 'ğŸŒ§ï¸', // ã«ã‚ã‹é›¨
            '10d': 'ğŸŒ¦ï¸', '10n': 'ğŸŒ§ï¸', // é›¨
            '11d': 'â›ˆï¸', '11n': 'â›ˆï¸', // é›·é›¨
            '13d': 'â„ï¸', '13n': 'â„ï¸', // é›ª
            '50d': 'ğŸŒ«ï¸', '50n': 'ğŸŒ«ï¸'  // éœ§ãƒ»ã‚‚ã‚„
        };

        /**
         * Nominatim APIã‚’ä½¿ã£ã¦åœ°åã‹ã‚‰ç·¯åº¦çµŒåº¦ã‚’å–å¾—ã—ã¾ã™ã€‚
         * @param {string} prefecture - éƒ½é“åºœçœŒå (ä¾‹: 'æ±äº¬éƒ½')
         * @param {string} city - å¸‚åŒºç”ºæ‘å (ä¾‹: 'æ¸‹è°·åŒº')
         * @returns {Promise<{lat: number, lon: number}>} ç·¯åº¦çµŒåº¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
         */
        async function getCoordinates(prefecture, city) {
            try {
                // å¸‚åŒºç”ºæ‘ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚Œã°éƒ½é“åºœçœŒã¨çµåˆã€ãªã‘ã‚Œã°éƒ½é“åºœçœŒå˜ç‹¬ã§æ¤œç´¢
                const query = city.trim() !== '' ? `${prefecture} ${city}, Japan` : `${prefecture}, Japan`;
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=1`);
                const data = await response.json();
                
                if (data.length > 0) {
                    return {
                        lat: parseFloat(data[0].lat),
                        lon: parseFloat(data[0].lon)
                    };
                }
                throw new Error('æŒ‡å®šã•ã‚ŒãŸåœ°åŸŸã®åº§æ¨™ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
            } catch (error) {
                console.error('åº§æ¨™å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                alert('æŒ‡å®šã•ã‚ŒãŸåœ°åŸŸã®åº§æ¨™ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚æ±äº¬ã®å¤©æ°—æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚');
                return { lat: 35.6586, lon: 139.7454 }; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåº§æ¨™ï¼ˆæ±äº¬ã‚¿ãƒ¯ãƒ¼ä»˜è¿‘ï¼‰
            }
        }

        /**
         * OpenWeatherMap APIã‹ã‚‰ç¾åœ¨ã®å¤©æ°—ã¨äºˆå ±ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ã€‚
         * @param {string} prefectureKey - éƒ½é“åºœçœŒã®ã‚­ãƒ¼ (ä¾‹: 'tokyo')
         * @param {string} prefectureName - éƒ½é“åºœçœŒå (ä¾‹: 'æ±äº¬éƒ½')
         * @param {string} city - å¸‚åŒºç”ºæ‘å (ä¾‹: 'æ¸‹è°·åŒº')
         * @param {{lat: number, lon: number}} coordinates - ç·¯åº¦çµŒåº¦
         * @returns {Promise<object>} æ•´å½¢ã•ã‚ŒãŸå¤©æ°—ãƒ‡ãƒ¼ã‚¿
         */
        async function fetchWeatherFromAPI(prefectureKey, prefectureName, city, coordinates) {
            try {
                // ç¾åœ¨ã®å¤©æ°—ãƒ‡ãƒ¼ã‚¿å–å¾—
                const currentResponse = await fetch(
                    `${OPENWEATHER_BASE_URL}/weather?lat=${coordinates.lat}&lon=${coordinates.lon}&appid=${OPENWEATHER_API_KEY}&units=metric&lang=ja`
                );
                const currentData = await currentResponse.json();
                
                // 5æ—¥é–“äºˆå ± (3æ™‚é–“ã”ã¨) ãƒ‡ãƒ¼ã‚¿å–å¾—
                const forecastResponse = await fetch(
                    `${OPENWEATHER_BASE_URL}/forecast?lat=${coordinates.lat}&lon=${coordinates.lon}&appid=${OPENWEATHER_API_KEY}&units=metric&lang=ja`
                );
                const forecastData = await forecastResponse.json();

                // å–å¾—ã—ãŸäºˆå ±ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢
                const processedForecasts = processForecastData(forecastData.list);

                return {
                    current: {
                        temperature: Math.round(currentData.main.temp),
                        condition: currentData.weather[0].icon,
                        description: currentData.weather[0].description,
                        humidity: currentData.main.humidity,
                        windSpeed: Math.round(currentData.wind.speed * 10) / 10, // å°æ•°ç‚¹ä»¥ä¸‹1æ¡
                        pressure: currentData.main.pressure,
                        visibility: Math.round(currentData.visibility / 1000), // mã‚’kmã«å¤‰æ›
                        uvIndex: 0, // OpenWeatherMapã®Current Weather APIã«ã¯UVæŒ‡æ•°ãŒãªã„ãŸã‚ãƒ€ãƒŸãƒ¼
                        feelsLike: Math.round(currentData.main.feels_like)
                    },
                    daily: processedForecasts.daily,    // æ—¥ã”ã¨ã®äºˆå ±ï¼ˆé€±é–“äºˆå ±ç”¨ï¼‰
                    hourly: processedForecasts.hourly, // 3æ™‚é–“ã”ã¨ã®äºˆå ±ï¼ˆ12æ™‚é–“åˆ†ï¼‰
                    coordinates: coordinates,
                    location: `${prefectureName}, ${city}`,
                    lastUpdated: new Date().toLocaleString('ja-JP') // æœ€çµ‚æ›´æ–°æ™‚åˆ»
                };
            } catch (error) {
                console.error('OpenWeatherMap APIã‚¨ãƒ©ãƒ¼:', error);
                throw new Error('å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚APIã‚­ãƒ¼ã¾ãŸã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            }
        }

        /**
         * OpenWeatherMapã‹ã‚‰å–å¾—ã—ãŸäºˆå ±ãƒªã‚¹ãƒˆã‚’é€±é–“äºˆå ±ã¨3æ™‚é–“ã”ã¨äºˆå ±ã«æ•´å½¢ã—ã¾ã™ã€‚
         * @param {Array<object>} forecastList - OpenWeatherMapã®forecast APIã‹ã‚‰å–å¾—ã—ãŸãƒªã‚¹ãƒˆ
         * @returns {{daily: Array<object>, hourly: Array<object>}} æ•´å½¢ã•ã‚ŒãŸäºˆå ±ãƒ‡ãƒ¼ã‚¿
         */
        function processForecastData(forecastList) {
            const dailyForecasts = {}; // æ—¥ã”ã¨ã®æœ€é«˜ãƒ»æœ€ä½æ°—æ¸©ãªã©ã‚’ä¿æŒ
            const hourlyForecasts = []; // 3æ™‚é–“ã”ã¨ã®è©³ç´°äºˆå ±ã‚’ä¿æŒ

            const now = new Date();
            now.setSeconds(0, 0); // ç§’ä»¥ä¸‹ã®æƒ…å ±ã‚’ã‚¯ãƒªã‚¢ã—ã€æ¯”è¼ƒã‚’æ­£ç¢ºã«

            forecastList.forEach(item => {
                const date = new Date(item.dt * 1000); // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
                
                // --- é€±é–“äºˆå ±ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç† ---
                const itemDateOnly = new Date(date);
                itemDateOnly.setHours(0, 0, 0, 0); // ãã®æ—¥ã®æ—¥ä»˜éƒ¨åˆ†ã®ã¿å–å¾—

                const dateKey = itemDateOnly.toDateString(); // æ—¥ä»˜ã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã®ã‚­ãƒ¼
                if (!dailyForecasts[dateKey]) {
                    // ãã®æ—¥ã®æœ€åˆã®ãƒ‡ãƒ¼ã‚¿ã§ã‚ã‚Œã°åˆæœŸåŒ–
                    dailyForecasts[dateKey] = {
                        // ã‚½ãƒ¼ãƒˆã®ä¿¡é ¼æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã€å®Œå…¨ãªDateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ ¼ç´
                        fullDate: itemDateOnly,
                        date: date.toLocaleDateString('ja-JP', {month: 'short', day: 'numeric', weekday: 'short'}),
                        high: -Infinity, // æœ€é«˜æ°—æ¸©ã®åˆæœŸå€¤
                        low: Infinity,    // æœ€ä½æ°—æ¸©ã®åˆæœŸå€¤
                        condition: item.weather[0].icon, // ä»£è¡¨çš„ãªå¤©æ°—ã‚¢ã‚¤ã‚³ãƒ³
                        precipitation: 0 // é™æ°´ç¢ºç‡ã®åˆæœŸå€¤
                    };
                }
                // ãã®æ—¥ã®æœ€é«˜ãƒ»æœ€ä½æ°—æ¸©ã‚’æ›´æ–°
                dailyForecasts[dateKey].high = Math.max(dailyForecasts[dateKey].high, Math.round(item.main.temp_max));
                dailyForecasts[dateKey].low = Math.min(dailyForecasts[dateKey].low, Math.round(item.main.temp_min));
                
                // ãã®æ—¥ã®é™æ°´ç¢ºç‡ï¼ˆ0ã§ãªã‘ã‚Œã°æ›´æ–°ï¼‰
                // åŒã˜æ—¥ã®è¤‡æ•°ã®äºˆå ±ã§é™æ°´ç¢ºç‡ãŒã‚ã‚‹å ´åˆã€æœ€å¤§å€¤ã‚’æ¡ç”¨ã™ã‚‹ã“ã¨ã‚‚æ¤œè¨
                if (dailyForecasts[dateKey].precipitation === 0 && item.pop > 0) {
                    dailyForecasts[dateKey].precipitation = Math.round((item.pop || 0) * 100);
                }


                // --- 3æ™‚é–“ã”ã¨ã®äºˆå ±ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç† ---
                // ç¾åœ¨æ™‚åˆ»ä»¥é™ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’å¯¾è±¡ã¨ã™ã‚‹ (OpenWeatherMap APIã¯æœªæ¥ã®ãƒ‡ãƒ¼ã‚¿ã—ã‹è¿”ã•ãªã„ã®ã§ã€å®Ÿéš›ã«ã¯å¸¸ã«æº€ãŸã•ã‚Œã‚‹)
                if (date.getTime() >= now.getTime()) { // Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç›´æ¥æ¯”è¼ƒã§ã¯ãªãgetTime()ã§æ¯”è¼ƒã™ã‚‹æ–¹ãŒç¢ºå®Ÿ
                    hourlyForecasts.push({
                        time: date.toLocaleTimeString('ja-JP', {hour: '2-digit', minute:'2-digit'}), // æ™‚åˆ»ã®ã¿
                        date: date.toLocaleDateString('ja-JP', {month: 'short', day: 'numeric', weekday: 'short'}), // å‚è€ƒç”¨
                        temp: Math.round(item.main.temp),
                        condition: item.weather[0].icon,
                        description: item.weather[0].description,
                        precipitation: Math.round((item.pop || 0) * 100)
                    });
                }
            });

            // é€±é–“äºˆå ±ã‚’æ—¥ä»˜é †ã«ã‚½ãƒ¼ãƒˆ (fullDateãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä½¿ç”¨)
            const sortedDailyForecasts = Object.values(dailyForecasts)
                .sort((a, b) => a.fullDate - b.fullDate);
            
            // 3æ™‚é–“ã”ã¨ã®äºˆå ±ã‚‚æ™‚åˆ»é †ã«ã‚½ãƒ¼ãƒˆ (APIã‹ã‚‰æ—¢ã«ã‚½ãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒå¤šã„ãŒå¿µã®ãŸã‚)
            hourlyForecasts.sort((a, b) => {
                // 'a.date'ã¨'a.time'ãŒæ­£ã—ããƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã€æœ‰åŠ¹ãªæ—¥ä»˜/æ™‚åˆ»æ–‡å­—åˆ—ã§ã‚ã‚‹ã¨ä»®å®š
                // ä¾‹: "6æœˆ26æ—¥(æœ¨) 09:00" ã¯ã€ä¿¡é ¼æ€§ã®é«˜ã„Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹ãŸã‚ã«å¹´æƒ…å ±ãŒå¿…è¦ã€‚
                // hourlyForecastsã«ç›´æ¥ã‚½ãƒ¼ãƒˆå¯èƒ½ãªã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¾ãŸã¯Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ ¼ç´ã™ã‚‹æ–¹ãŒè‰¯ã„ã€‚
                // ã¨ã‚Šã‚ãˆãšã€'date'ã¨'time'ãŒä¸€è²«ã—ã¦ã„ã‚Œã°ã€å˜ç´”ãªã‚±ãƒ¼ã‚¹ã§ã¯æ©Ÿèƒ½ã™ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚
                // ã‚ˆã‚Šå …ç‰¢ãªè§£æ±ºç­–ã¯ã€hourlyForecastsã«ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹éš›ã«'dt'ã¾ãŸã¯'fullDateTime'ã‚’ç›´æ¥è¿½åŠ ã™ã‚‹ã“ã¨ã€‚
                
                // ã‚ˆã‚Šå …ç‰¢ãªæ¯”è¼ƒã®ãŸã‚ã€'date'ãŒã€ŒMæœˆDæ—¥(æ›œ)ã€å½¢å¼ã€'time'ãŒã€ŒHH:MMã€å½¢å¼ã¨ä»®å®š
                // å¹´ã‚’æ¨æ¸¬ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ç°¡ç•¥åŒ–ã®ãŸã‚ã€å¹´ã‚’ã¾ãŸãŒãªã„é™ã‚Šç¾åœ¨ã®å¹´ã¨ä»®å®šã€‚
                const year = new Date().getFullYear();
                const parseDateString = (dateStr, timeStr) => {
                    const parts = dateStr.match(/(\d{1,2})æœˆ(\d{1,2})æ—¥/);
                    if (!parts) return null;
                    const month = parseInt(parts[1]) - 1; // æœˆã¯0ã‹ã‚‰å§‹ã¾ã‚‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
                    const day = parseInt(parts[2]);
                    return new Date(year, month, day, parseInt(timeStr.substring(0, 2)), parseInt(timeStr.substring(3, 5)));
                };

                const dateTimeA = parseDateString(a.date, a.time);
                const dateTimeB = parseDateString(b.date, b.time);

                if (dateTimeA && dateTimeB) {
                    return dateTimeA.getTime() - dateTimeB.getTime();
                }
                return 0; // è§£æå¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            });


            return {
                daily: sortedDailyForecasts.slice(0, 7), // é€±é–“äºˆå ±ã¯æœ€å¤§7æ—¥åˆ†
                hourly: hourlyForecasts.slice(0, 4) // 3æ™‚é–“ã”ã¨äºˆå ±ã¯ç›´è¿‘4ã¤ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆ12æ™‚é–“åˆ†ï¼‰
            };
        }

        /**
         * å¤©æ°—æƒ…å ±ã‚’å–å¾—ã—ã€è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹ãƒ¡ã‚¤ãƒ³é–¢æ•°ã§ã™ã€‚
         * ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã€APIå‘¼ã³å‡ºã—ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ã€‚
         */
        async function updateWeather() {
            try {
                const prefecture = document.getElementById('prefecture').value;
                const city = document.getElementById('city').value;
                const prefectureName = prefectures[prefecture];
                
                // UIã‚’ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã«åˆ‡ã‚Šæ›¿ãˆã‚‹
                document.getElementById('current-weather').innerHTML = '<div class="loading">ç¾åœ¨ã®å¤©æ°—æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';
                document.getElementById('forecast').innerHTML = '<div class="loading">é€±é–“äºˆå ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';
                document.getElementById('hourly-forecast').innerHTML = '<div class="loading">è©³ç´°äºˆå ±ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';
                
                // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒƒãƒ—ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºï¼ˆradar-overlayã¯æ®‹ã™ï¼‰
                const radarMapWrapper = document.getElementById('radar-map-wrapper');
                radarMapWrapper.innerHTML = '<div class="loading">åœ°å›³ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';
                if (radarVisible) {
                    const radarOverlay = document.createElement('div');
                    radarOverlay.className = 'radar-overlay';
                    radarMapWrapper.appendChild(radarOverlay);
                }


                // æ¥ç¶šçŠ¶æ…‹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’ã€Œæ¥ç¶šä¸­ã€ã«
                document.querySelector('.status-indicator').className = 'status-indicator status-connected';
                
                // å¤©æ°—ãƒ‡ãƒ¼ã‚¿å–å¾—
                const coordinates = await getCoordinates(prefectureName, city);
                const apiData = await fetchWeatherFromAPI(prefecture, prefectureName, city, coordinates);
                weatherData = apiData; // å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜
                currentCoordinates = coordinates; // å–å¾—ã—ãŸåº§æ¨™ã‚’ä¿å­˜

                // UIã®è¡¨ç¤ºã‚’æ›´æ–°
                displayCurrentWeather(weatherData);
                displayForecast(weatherData);
                displayHourlyForecast(weatherData);
                await updateMapDisplay(currentCoordinates, prefectureName, city); // ãƒ¬ãƒ¼ãƒ€ãƒ¼è¡¨ç¤ºã®æ›´æ–°

                // 3æ™‚é–“ã”ã¨äºˆå ±ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
                updateHourlyForecastTitle();    
                
            } catch (error) {
                console.error('å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—:', error);
                document.querySelector('.status-indicator').className = 'status-indicator status-error'; // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
                
                // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’UIã«è¡¨ç¤º
                const errorHTML = `<div class="error">å¤©æ°—æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>${error.message}</div>`;
                document.getElementById('current-weather').innerHTML = errorHTML;
                document.getElementById('forecast').innerHTML = errorHTML;
                document.getElementById('hourly-forecast').innerHTML = errorHTML;
                
                const radarMapWrapper = document.getElementById('radar-map-wrapper');
                radarMapWrapper.innerHTML = '<div>åœ°å›³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</div>';
                if (radarVisible) {
                    const radarOverlay = document.createElement('div');
                    radarOverlay.className = 'radar-overlay';
                    radarMapWrapper.appendChild(radarOverlay);
                }
            }
        }

        /**
         * OpenStreetMapã®åœ°å›³è¡¨ç¤ºã‚’æ›´æ–°ã—ã¾ã™ã€‚
         * @param {{lat: number, lon: number}} coordinates - è¡¨ç¤ºã™ã‚‹ä¸­å¿ƒã®ç·¯åº¦çµŒåº¦
         * @param {string} prefecture - éƒ½é“åºœçœŒå
         * @param {string} city - å¸‚åŒºç”ºæ‘å
         */
        async function updateMapDisplay(coordinates, prefecture, city) {
            const radarMapWrapper = document.getElementById('radar-map-wrapper');
            
            if (radarVisible && coordinates) {
                // iframeã§OpenStreetMapã®åŸ‹ã‚è¾¼ã¿åœ°å›³ã‚’è¡¨ç¤º
                // bboxã®ç¯„å›²ã‚’èª¿æ•´ã—ã¦ã€ã‚ˆã‚Šåºƒã„ç¯„å›²ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½
                radarMapWrapper.innerHTML = `
                    <iframe 
                        width="100%" 
                        height="100%" 
                        style="border: none;"
                        src="https://www.openstreetmap.org/export/embed.html?bbox=${coordinates.lon-0.1},${coordinates.lat-0.07},${coordinates.lon+0.1},${coordinates.lat+0.07}&layer=mapnik&marker=${coordinates.lat},${coordinates.lon}"
                        allowfullscreen>
                    </iframe>
                    <div style="position: absolute; bottom: 10px; left: 10px; background: rgba(255,255,255,0.9); padding: 5px; font-size: 12px; border-radius: 3px;">
                        ${prefecture}, ${city}<br>
                        ç·¯åº¦: ${coordinates.lat.toFixed(4)}, çµŒåº¦: ${coordinates.lon.toFixed(4)}
                    </div>
                    <div class="radar-overlay"></div>`;
            } else if (!radarVisible) {
                // ãƒ¬ãƒ¼ãƒ€ãƒ¼éè¡¨ç¤ºã®å ´åˆ
                radarMapWrapper.innerHTML = '<div>ãƒ¬ãƒ¼ãƒ€ãƒ¼è¡¨ç¤ºãŒç„¡åŠ¹ã§ã™</div><div class="radar-overlay hidden"></div>';
            } else {
                // åº§æ¨™ãŒå–å¾—ã§ããªã„å ´åˆãªã©
                radarMapWrapper.innerHTML = '<div>åœ°å›³æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚</div><div class="radar-overlay"></div>';
            }
        }

        /**
         * ãƒ¬ãƒ¼ãƒ€ãƒ¼è¡¨ç¤ºã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚
         */
        function toggleRadar() {
            radarVisible = !radarVisible;
            const prefecture = document.getElementById('prefecture').value;
            const city = document.getElementById('city').value;
            const prefectureName = prefectures[prefecture];
            
            if (currentCoordinates) {
                // æ—¢ã«å–å¾—æ¸ˆã¿ã®åº§æ¨™ã§åœ°å›³ã‚’æ›´æ–°
                updateMapDisplay(currentCoordinates, prefectureName, city);
            } else {
                // åº§æ¨™ãŒã¾ã å–å¾—ã•ã‚Œã¦ã„ãªã„å ´åˆã€updateWeatherã‚’å‘¼ã³å‡ºã—ã¦ãƒ‡ãƒ¼ã‚¿å–å¾—ã‹ã‚‰ã‚„ã‚Šç›´ã™
                updateWeather();
            }
        }

        /**
         * ç¾åœ¨ã®å¤©æ°—æƒ…å ±ã‚’UIã«è¡¨ç¤ºã—ã¾ã™ã€‚
         * @param {object} data - ç¾åœ¨ã®å¤©æ°—ãƒ‡ãƒ¼ã‚¿
         */
        function displayCurrentWeather(data) {
            const currentWeatherDiv = document.getElementById('current-weather');
            const weather = data.current;
            
            currentWeatherDiv.innerHTML = `
                <div class="weather-icon">${weatherIcons[weather.condition] || 'ğŸŒ¤ï¸'}</div>
                <div class="temperature">${weather.temperature}Â°C</div>
                <div style="font-size: 1.1em; color: #666; margin-bottom: 20px;">
                    ${weather.description || 'æƒ…å ±ãªã—'}<br>
                    ä½“æ„Ÿæ¸©åº¦: ${weather.feelsLike}Â°C
                </div>
                <div class="weather-details">
                    <div class="detail-item">
                        <span>æ¹¿åº¦</span>
                        <span>${weather.humidity}%</span>
                    </div>
                    <div class="detail-item">
                        <span>é¢¨é€Ÿ</span>
                        <span>${weather.windSpeed} m/s</span>
                    </div>
                    <div class="detail-item">
                        <span>æ°—åœ§</span>
                        <span>${weather.pressure} hPa</span>
                    </div>
                    <div class="detail-item">
                        <span>è¦–ç•Œ</span>
                        <span>${weather.visibility} km</span>
                    </div>
                    <div class="detail-item">
                        <span>UVæŒ‡æ•°</span>
                        <span>${weather.uvIndex}</span>
                    </div>
                    <div class="detail-item">
                        <span>æœ€çµ‚æ›´æ–°</span>
                        <span>${data.lastUpdated}</span>
                    </div>
                </div>
            `;
        }

        /**
         * é€±é–“å¤©æ°—äºˆå ±ã‚’UIã«è¡¨ç¤ºã—ã¾ã™ã€‚
         * @param {object} data - é€±é–“äºˆå ±ãƒ‡ãƒ¼ã‚¿
         */
        function displayForecast(data) {
            const forecastDiv = document.getElementById('forecast');
            
            // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            if (!data.daily || data.daily.length === 0) {
                forecastDiv.innerHTML = '<div style="padding: 15px; text-align: center; color: #666;">é€±é–“äºˆå ±ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
                return;
            }

            const forecastHTML = data.daily.map(day => `
                <div class="forecast-item">
                    <div class="forecast-date">${day.date}</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.5em;">${weatherIcons[day.condition] || 'ğŸŒ¤ï¸'}</span>
                        <span>é™æ°´ç¢ºç‡: ${day.precipitation}%</span>
                    </div>
                    <div class="forecast-temp">${day.high}Â°/${day.low}Â°</div>
                </div>
            `).join('');
            
            forecastDiv.innerHTML = forecastHTML;
        }

        /**
         * 3æ™‚é–“ã”ã¨ã®äºˆå ±ã‚’UIã«è¡¨ç¤ºã—ã¾ã™ã€‚
         * @param {object} data - 3æ™‚é–“ã”ã¨ã®äºˆå ±ãƒ‡ãƒ¼ã‚¿
         */
        function displayHourlyForecast(data) {
            const hourlyForecastDiv = document.getElementById('hourly-forecast');
            
            // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            if (!data.hourly || data.hourly.length === 0) {
                hourlyForecastDiv.innerHTML = '<div style="padding: 15px; text-align: center; color: #666;">3æ™‚é–“äºˆå ±ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
                return;
            }

            const hourlyHTML = data.hourly.map(item => `
                <div class="forecast-item">
                    <div class="forecast-date">${item.time}</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.5em;">${weatherIcons[item.condition] || 'ğŸŒ¤ï¸'}</span>
                        <span>${item.description}</span>
                    </div>
                    <div class="forecast-temp">${item.temp}Â°C</div>
                </div>
            `).join('');
            
            hourlyForecastDiv.innerHTML = hourlyHTML;
        }

        /**
         * 3æ™‚é–“ã”ã¨äºˆå ±ã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä¾‹:ã€Œ6æœˆ26æ—¥ 3æ™‚é–“äºˆå ±ã€ï¼‰ã‚’æ›´æ–°ã—ã¾ã™ã€‚
         */
        function updateHourlyForecastTitle() {
            const titleElement = document.getElementById('hourly-forecast-title');
            if (!titleElement) return;

            const now = new Date();
            // ä¾‹: "6æœˆ26æ—¥" ã®å½¢å¼ã§å–å¾—
            const formattedDate = now.toLocaleDateString('ja-JP', {
                month: 'numeric',
                day: 'numeric'
            });

            titleElement.textContent = `${formattedDate} 3æ™‚é–“äºˆå ±`;
        }

        /**
         * è‡ªå‹•æ›´æ–°ã®è¨­å®šã¨ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚
         */
        function setupAutoUpdate() {
            const autoUpdateCheckbox = document.getElementById('auto-update');
            const intervalSelect = document.getElementById('update-interval');
            
            function updateAutoUpdate() {
                if (updateInterval) {
                    clearInterval(updateInterval); // æ—¢å­˜ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
                }
                
                if (autoUpdateCheckbox.checked) {
                    const interval = parseInt(intervalSelect.value);
                    updateInterval = setInterval(updateWeather, interval); // æ–°ã—ã„ã‚¿ã‚¤ãƒãƒ¼ã‚’è¨­å®š
                }
            }
            
            autoUpdateCheckbox.addEventListener('change', updateAutoUpdate);
            intervalSelect.addEventListener('change', updateAutoUpdate);
            
            // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸè¨­å®šã‚’é©ç”¨
            updateAutoUpdate();
        }

        // ãƒšãƒ¼ã‚¸ã®åˆæœŸåŒ–å‡¦ç†
        document.addEventListener('DOMContentLoaded', function() {
            updateWeather(); // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«æœ€åˆã®å¤©æ°—æƒ…å ±ã‚’è¡¨ç¤º
            setupAutoUpdate(); // è‡ªå‹•æ›´æ–°æ©Ÿèƒ½ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
            updateHourlyForecastTitle(); // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã«3æ™‚é–“äºˆå ±ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚‚æ›´æ–°
            
            // éƒ½é“åºœçœŒé¸æŠãŒå¤‰æ›´ã•ã‚ŒãŸéš›ã®å‡¦ç†
            document.getElementById('prefecture').addEventListener('change', function() {
                // éƒ½é“åºœçœŒã«å¿œã˜ã¦å¸‚åŒºç”ºæ‘ã®åˆæœŸå€¤ã‚’å¤‰æ›´ã™ã‚‹ï¼ˆä¾‹ï¼‰
                const cities = {
                    'tokyo': 'æ¸‹è°·åŒº',
                    'osaka': 'å¤§é˜ªå¸‚',
                    'kyoto': 'äº¬éƒ½å¸‚',
                    'fukuoka': 'åšå¤šåŒº',
                    'hokkaido': 'æœ­å¹Œå¸‚',
                    'okinawa': 'é‚£è¦‡å¸‚',
                    'aichi': 'åå¤å±‹å¸‚',
                    'kanagawa': 'æ¨ªæµœå¸‚',
                    'saitama': 'ã•ã„ãŸã¾å¸‚',
                    'chiba': 'åƒè‘‰å¸‚'
                };
                
                document.getElementById('city').value = cities[this.value] || ''; // è©²å½“ãŒãªã‘ã‚Œã°ç©ºã«
            });
        });
    </script>
</body>
</html>